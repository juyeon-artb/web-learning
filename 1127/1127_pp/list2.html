<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Modern ToDo App ‚Äî Final Stable Version</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Ìè∞Ìä∏ -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: "Poppins", sans-serif;
        background: #f5f7fb;
        color: #333;
      }
      .page {
        width: 100%;
        min-height: 100vh;
        padding: 32px 16px 40px;
        display: none;
      }
      .page.active {
        display: block;
        animation: slide 0.3s ease;
      }
      @keyframes slide {
        from {
          opacity: 0;
          transform: translateX(20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
      }
      .top-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
      }
      .title {
        font-size: 28px;
        font-weight: 700;
        color: #2e6eff;
      }
      .profile {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .profile-name {
        font-size: 14px;
        color: #5b647a;
        cursor: pointer;
      }
      .profile-img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        overflow: hidden;
        border: 2px solid #dbe3ff;
        cursor: pointer;
      }
      .profile-img img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .page-arrow {
        position: fixed;
        right: 16px;
        bottom: 16px;
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background: #2e6eff;
        border: none;
        color: white;
        font-size: 22px;
        cursor: pointer;
        box-shadow: 0 6px 20px rgba(46, 139, 255, 0.4);
      }

      .week-wrapper {
        background: white;
        border-radius: 16px;
        padding: 8px 12px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
        margin-bottom: 16px;
      }
      .week-days {
        display: flex;
        gap: 6px;
      }
      .week-day {
        width: 34px;
        height: 46px;
        border-radius: 999px;
        background: #f3f5ff;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        color: #7a849a;
        position: relative;
      }
      .week-day .date {
        font-size: 13px;
        font-weight: 600;
        color: #4b5687;
      }
      .week-day.today {
        background: #2e6eff;
        color: white;
      }
      .week-day.today .date {
        color: white;
      }
      .week-dot {
        width: 6px;
        height: 6px;
        background: #2e6eff;
        border-radius: 50%;
        position: absolute;
        bottom: 6px;
      }

      .todo-input-card {
        background: white;
        border-radius: 18px;
        padding: 18px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
        margin-bottom: 18px;
      }
      .todo-row {
        display: flex;
        gap: 10px;
      }
      #todo-input {
        flex: 1;
        padding: 11px 14px;
        border-radius: 12px;
        border: 1px solid #d8def0;
        font-size: 14px;
      }
      .btn-primary {
        padding: 11px 16px;
        border-radius: 12px;
        background: #2e6eff;
        color: white;
        font-weight: 600;
        cursor: pointer;
        border: none;
        font-size: 14px;
      }
      .filter-row {
        display: flex;
        gap: 8px;
        margin-top: 12px;
      }
      .filter-btn {
        padding: 6px 12px;
        border-radius: 999px;
        border: none;
        background: #e6edff;
        color: #3c569f;
        cursor: pointer;
        font-size: 12px;
      }
      .filter-btn.active {
        background: #2e6eff;
        color: white;
        font-weight: 600;
      }

      #todo-list {
        list-style: none;
        margin-top: 16px;
      }
      .todo-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: white;
        margin-bottom: 10px;
        padding: 10px 12px;
        border-radius: 14px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
        cursor: grab;
        transition: 0.2s;
      }
      .todo-item.completed {
        opacity: 0.7;
      }
      .check {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 2px solid #2e6eff;
        cursor: pointer;
      }
      .todo-item.completed .check {
        background: #2e6eff;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .todo-item.completed .check::after {
        content: "‚úì";
        font-size: 12px;
        color: white;
        margin-top: -1px;
      }
      .todo-text {
        flex: 1;
        font-size: 14px;
        margin-left: 8px;
      }
      .todo-item.completed .todo-text {
        text-decoration: line-through;
        color: #9aa4b5;
      }
      .actions {
        display: flex;
        gap: 6px;
      }
      .btn-edit,
      .btn-date {
        padding: 4px 8px;
        font-size: 11px;
        border-radius: 8px;
        border: 1px solid #cfd7f0;
        background: #f3f6ff;
        cursor: pointer;
      }
      .btn-delete {
        padding: 4px 8px;
        font-size: 11px;
        border-radius: 8px;
        background: #ff6b6b;
        color: white;
        border: none;
        cursor: pointer;
      }

      .summary {
        margin-top: 16px;
        background: white;
        border-radius: 14px;
        padding: 10px 12px;
        text-align: center;
        font-size: 14px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
      }

      .memo-box {
        margin-top: 16px;
        background: white;
        border-radius: 14px;
        padding: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
      }
      #memo-text {
        width: 100%;
        height: 140px;
        border-radius: 12px;
        background: #f7f9ff;
        border: 1px solid #d8def0;
        padding: 8px;
        resize: none;
        font-size: 13px;
      }

      .calendar-card {
        max-width: 420px;
        margin: 40px auto 0;
        background: white;
        border-radius: 18px;
        padding: 20px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
      }
      .calendar-title {
        font-size: 22px;
        font-weight: 700;
        color: #2e6eff;
        text-align: center;
        margin-bottom: 6px;
      }
      .month-control {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 18px;
        margin-bottom: 8px;
      }
      .month-btn {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #e8eeff;
        color: #2e6eff;
        border: none;
        cursor: pointer;
      }
      .weekdays,
      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        text-align: center;
        gap: 6px;
        margin-top: 8px;
        font-size: 12px;
      }
      .day-cell {
        width: 38px;
        height: 38px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        position: relative;
      }
      .day-cell.today {
        border: 2px solid #2e6eff;
        font-weight: 600;
      }
      .day-cell.selected {
        background: #2e6eff;
        color: white;
        box-shadow: 0 4px 12px rgba(46, 139, 255, 0.5);
      }
      .day-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        position: absolute;
        bottom: 4px;
        left: 50%;
        transform: translateX(-50%);
      }
      .day-dot.incomplete {
        background: #2e6eff;
      }
      .day-dot.complete {
        background: #76d47a;
      }

      #cal-memo {
        width: 100%;
        height: 70px;
        margin-top: 10px;
        border-radius: 12px;
        background: #f7f9ff;
        border: 1px solid #d8def0;
        padding: 8px;
        font-size: 13px;
      }
    </style>
  </head>

  <body>
    <!-- PAGE 1 -->
    <section class="page active" id="page-todo">
      <div class="container">
        <div class="top-bar">
          <div class="title">To Do List</div>
          <div class="profile">
            <div class="profile-name" id="profile-name">Hello, User</div>
            <div class="profile-img" id="profile-img-box">
              <img
                id="profile-img"
                src="https://images.pexels.com/photos/614810/pexels-photo-614810.jpeg?auto=compress&cs=tinysrgb&w=200"
              />
            </div>
          </div>
        </div>

        <input
          type="file"
          id="profile-upload"
          accept="image/*"
          style="display: none"
        />

        <div class="week-wrapper">
          <div class="week-label">This Week</div>
          <div class="week-days" id="week-days"></div>
        </div>

        <div class="todo-input-card">
          <div class="todo-row">
            <input
              id="todo-input"
              type="text"
              placeholder="Ìï† ÏùºÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
            />
            <button class="btn-primary" id="add-btn">Ï∂îÍ∞Ä</button>
          </div>

          <div class="filter-row">
            <button class="filter-btn active" data-filter="all">Ï†ÑÏ≤¥</button>
            <button class="filter-btn" data-filter="active">ÎØ∏ÏôÑÎ£å</button>
            <button class="filter-btn" data-filter="completed">ÏôÑÎ£å</button>
          </div>
        </div>

        <ul id="todo-list"></ul>

        <div class="summary">
          Ï¥ù <span id="sum-total">0</span>Í∞ú / ÏôÑÎ£å
          <span id="sum-complete">0</span>Í∞ú / ÎÇ®ÏùÄ
          <span id="sum-left">0</span>Í∞ú
        </div>

        <div class="memo-box">
          <textarea id="memo-text" placeholder="Î©îÎ™®Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî"></textarea>
        </div>
      </div>

      <button class="page-arrow" id="btn-to-calendar">üìÖ</button>
    </section>

    <!-- PAGE 2 -->
    <section class="page" id="page-calendar">
      <div class="container">
        <div class="top-bar">
          <div class="title">Calendar</div>
        </div>

        <div class="calendar-card">
          <div class="calendar-title">Monthly View</div>

          <div class="month-control">
            <button class="month-btn" id="prev-month">‚Äπ</button>
            <div class="month-label" id="month-label"></div>
            <button class="month-btn" id="next-month">‚Ä∫</button>
          </div>

          <div class="weekdays">
            <div>Mon</div>
            <div>Tue</div>
            <div>Wed</div>
            <div>Thu</div>
            <div>Fri</div>
            <div>Sat</div>
            <div>Sun</div>
          </div>

          <div class="calendar-grid" id="calendar-grid"></div>

          <div class="cal-selected-label" id="cal-selected-label">
            ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî
          </div>
          <textarea id="cal-memo" disabled></textarea>
        </div>
      </div>

      <button class="page-arrow" id="btn-to-todo">‚¨Ö</button>
    </section>

    <script>
      const pageTodo = document.getElementById("page-todo");
      const pageCalendar = document.getElementById("page-calendar");

      document.getElementById("btn-to-calendar").onclick = () => {
        pageTodo.classList.remove("active");
        pageCalendar.classList.add("active");
        renderCalendar();
      };
      document.getElementById("btn-to-todo").onclick = () => {
        pageCalendar.classList.remove("active");
        pageTodo.classList.add("active");
        renderWeek();
      };

      /* KEYS */
      const TODO_KEY = "modern_todos_v1";
      const MEMO_KEY = "modern_memo_v1";
      const PROFILE_KEY = "modern_profile_img_v1";
      const PROFILE_NAME_KEY = "modern_profile_name_v1";
      const CAL_MEMO_KEY = "modern_calendar_memo_";

      let todos = [];
      let filter = "all";
      let dragSourceId = null;

      const today = new Date();
      const todayStr = formatYMD(today);

      /* format */
      function formatYMD(date) {
        return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(
          2,
          "0"
        )}-${String(date.getDate()).padStart(2, "0")}`;
      }

      /* load */
      function loadData() {
        const t = localStorage.getItem(TODO_KEY);
        if (t) todos = JSON.parse(t);
        const m = localStorage.getItem(MEMO_KEY);
        if (m) document.getElementById("memo-text").value = m;
      }

      /* save */
      function saveData() {
        localStorage.setItem(TODO_KEY, JSON.stringify(todos));
      }

      /* memo save */
      document.getElementById("memo-text").oninput = (e) => {
        localStorage.setItem(MEMO_KEY, e.target.value);
      };

      /* ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ */
      const profileImg = document.getElementById("profile-img");
      const profileUpload = document.getElementById("profile-upload");
      document.getElementById("profile-img-box").onclick = () => {
        profileUpload.click();
      };
      profileUpload.onchange = function () {
        const file = this.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
          profileImg.src = e.target.result;
          localStorage.setItem(PROFILE_KEY, e.target.result);
        };
        reader.readAsDataURL(file);
      };
      function loadProfileImg() {
        const saved = localStorage.getItem(PROFILE_KEY);
        if (saved) profileImg.src = saved;
      }

      /* ÌîÑÎ°úÌïÑ Ïù¥Î¶Ñ */
      const profileNameEl = document.getElementById("profile-name");
      function loadProfileName() {
        const saved = localStorage.getItem(PROFILE_NAME_KEY);
        if (saved) profileNameEl.textContent = saved;
      }
      profileNameEl.onclick = () => {
        const current = profileNameEl.textContent.replace("Hello, ", "");
        const nm = prompt("Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî", current);
        if (nm && nm.trim() !== "") {
          const final = `Hello, ${nm.trim()}`;
          profileNameEl.textContent = final;
          localStorage.setItem(PROFILE_NAME_KEY, final);
        }
      };

      /* ADD TODO */
      const todoInput = document.getElementById("todo-input");
      document.getElementById("add-btn").onclick = addTodo;
      todoInput.onkeydown = (e) => {
        if (e.key === "Enter") addTodo();
      };

      function addTodo() {
        const txt = todoInput.value.trim();
        if (!txt) return;

        todos.push({
          id: Date.now(),
          text: txt,
          completed: false,
          date: null,
          order: todos.length,
        });

        todoInput.value = "";
        saveData();
        renderTodos();
        renderWeek();
        renderCalendar();
      }

      /* toggle */
      function toggleTodo(id) {
        todos = todos.map((t) =>
          t.id === id ? { ...t, completed: !t.completed } : t
        );
        saveData();
        renderTodos();
        renderWeek();
        renderCalendar();
      }

      /* summary */
      function updateSummary() {
        const total = todos.length;
        const comp = todos.filter((t) => t.completed).length;

        document.getElementById("sum-total").textContent = total;
        document.getElementById("sum-complete").textContent = comp;
        document.getElementById("sum-left").textContent = total - comp;
      }

      /* render todos */
      function renderTodos() {
        const list = document.getElementById("todo-list");
        list.innerHTML = "";

        todos.sort((a, b) => a.order - b.order);

        let filtered = todos;
        if (filter === "active") filtered = todos.filter((t) => !t.completed);
        if (filter === "completed") filtered = todos.filter((t) => t.completed);

        filtered.forEach((todo) => {
          const li = document.createElement("li");
          li.className = "todo-item";
          if (todo.completed) li.classList.add("completed");
          li.dataset.id = todo.id;
          li.draggable = true;

          li.addEventListener("dragstart", (e) => {
            dragSourceId = todo.id;
          });
          li.addEventListener("dragover", (e) => {
            e.preventDefault();
            li.classList.add("drag-over");
          });
          li.addEventListener("dragleave", () =>
            li.classList.remove("drag-over")
          );
          li.addEventListener("drop", () => {
            li.classList.remove("drag-over");
            reorderTodos(dragSourceId, todo.id);
          });

          const check = document.createElement("div");
          check.className = "check";
          check.onclick = () => toggleTodo(todo.id);

          const text = document.createElement("div");
          text.className = "todo-text";
          text.textContent = todo.text;

          const actions = document.createElement("div");
          actions.className = "actions";

          /* date picker ‚Äî Ïó¨Í∏∞ ÏôÑÎ≤Ω ÏàòÏ†ïÎê® */
          const dateBtn = document.createElement("button");
          dateBtn.className = "btn-date";
          dateBtn.textContent = todo.date || "ÎÇ†Ïßú";

          const dateInput = document.createElement("input");
          dateInput.type = "date";

          /* ÌôîÎ©¥ÏóêÏÑú Ïïà Î≥¥Ïù¥ÏßÄÎßå DOMÏóêÎäî Ï°¥Ïû¨Ìï¥ÏïºÌï® */
          dateInput.style.position = "absolute";
          dateInput.style.left = "-9999px";
          dateInput.style.opacity = "0";

          if (todo.date) dateInput.value = todo.date;

          dateBtn.onclick = () => {
            if (dateInput.showPicker) {
              try {
                dateInput.showPicker();
                return;
              } catch (e) {}
            }
            dateInput.click();
          };

          dateInput.onchange = (e) => {
            todo.date = e.target.value || null;
            dateBtn.textContent = todo.date || "ÎÇ†Ïßú";
            saveData();
            renderWeek();
            renderCalendar();
          };

          const editBtn = document.createElement("button");
          editBtn.className = "btn-edit";
          editBtn.textContent = "ÏàòÏ†ï";
          editBtn.onclick = () => {
            const nv = prompt("ÏàòÏ†ï", todo.text);
            if (nv !== null) {
              todo.text = nv.trim();
              saveData();
              renderTodos();
            }
          };

          const delBtn = document.createElement("button");
          delBtn.className = "btn-delete";
          delBtn.textContent = "ÏÇ≠Ï†ú";
          delBtn.onclick = () => {
            todos = todos.filter((t) => t.id !== todo.id);
            saveData();
            renderTodos();
            renderWeek();
            renderCalendar();
          };

          actions.append(dateBtn, dateInput, editBtn, delBtn);
          li.append(check, text, actions);
          list.appendChild(li);
        });

        updateSummary();
      }

      /* reorder */
      function reorderTodos(fromId, toId) {
        if (fromId === toId) return;
        const from = todos.findIndex((t) => t.id === fromId);
        const to = todos.findIndex((t) => t.id === toId);
        const [mv] = todos.splice(from, 1);
        todos.splice(to, 0, mv);
        todos = todos.map((t, i) => ({ ...t, order: i }));
        saveData();
        renderTodos();
      }

      /* filter */
      document.querySelectorAll(".filter-btn").forEach((btn) => {
        btn.onclick = () => {
          document
            .querySelectorAll(".filter-btn")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          filter = btn.dataset.filter;
          renderTodos();
        };
      });

      /* WEEK */
      const weekDaysEl = document.getElementById("week-days");
      function getMonday(d) {
        const date = new Date(d);
        const day = (date.getDay() + 6) % 7;
        date.setDate(date.getDate() - day);
        return date;
      }
      function renderWeek() {
        weekDaysEl.innerHTML = "";
        const monday = getMonday(today);

        for (let i = 0; i < 7; i++) {
          const d = new Date(monday);
          d.setDate(monday.getDate() + i);
          const ymd = formatYMD(d);

          const box = document.createElement("div");
          box.className = "week-day";

          const names = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
          const n = document.createElement("span");
          n.textContent = names[i];

          const dt = document.createElement("span");
          dt.className = "date";
          dt.textContent = d.getDate();

          if (ymd === todayStr) box.classList.add("today");

          if (todos.some((t) => t.date === ymd)) {
            const dot = document.createElement("div");
            dot.className = "week-dot";
            box.appendChild(dot);
          }

          box.append(n, dt);
          weekDaysEl.appendChild(box);
        }
      }

      /* CALENDAR */
      let calYear = today.getFullYear();
      let calMonth = today.getMonth();
      let selectedYMD = null;

      function renderCalendar() {
        const monthLabel = document.getElementById("month-label");
        const grid = document.getElementById("calendar-grid");

        grid.innerHTML = "";

        const first = new Date(calYear, calMonth, 1);
        const last = new Date(calYear, calMonth + 1, 0).getDate();
        const start = (first.getDay() + 6) % 7;

        monthLabel.textContent =
          first.toLocaleString("default", { month: "long" }).toUpperCase() +
          " " +
          calYear;

        for (let i = 0; i < start; i++)
          grid.appendChild(document.createElement("div"));

        for (let d = 1; d <= last; d++) {
          const cell = document.createElement("div");
          cell.className = "day-cell";
          cell.textContent = d;

          const dateObj = new Date(calYear, calMonth, d);
          const ymd = formatYMD(dateObj);

          if (ymd === todayStr) cell.classList.add("today");
          if (ymd === selectedYMD) cell.classList.add("selected");

          const dayTodos = todos.filter((t) => t.date === ymd);
          if (dayTodos.length > 0) {
            const dot = document.createElement("div");
            dot.className = "day-dot";
            dot.classList.add(
              dayTodos.some((t) => !t.completed) ? "incomplete" : "complete"
            );
            cell.appendChild(dot);
          }

          cell.onclick = () => {
            selectedYMD = ymd;
            renderCalendar();
            loadCalMemo();
          };

          grid.appendChild(cell);
        }
      }

      function loadCalMemo() {
        const label = document.getElementById("cal-selected-label");
        const memo = document.getElementById("cal-memo");

        if (!selectedYMD) {
          memo.disabled = true;
          memo.value = "";
          label.textContent = "ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî";
          return;
        }
        memo.disabled = false;
        label.textContent = `${selectedYMD} Î©îÎ™®`;

        const saved = localStorage.getItem(CAL_MEMO_KEY + selectedYMD);
        memo.value = saved || "";
      }

      document.getElementById("cal-memo").oninput = (e) => {
        if (!selectedYMD) return;
        localStorage.setItem(CAL_MEMO_KEY + selectedYMD, e.target.value);
      };

      document.getElementById("prev-month").onclick = () => {
        calMonth--;
        if (calMonth < 0) {
          calMonth = 11;
          calYear--;
        }
        renderCalendar();
      };
      document.getElementById("next-month").onclick = () => {
        calMonth++;
        if (calMonth > 11) {
          calMonth = 0;
          calYear++;
        }
        renderCalendar();
      };

      /* INIT */
      loadData();
      loadProfileImg();
      loadProfileName();
      renderTodos();
      renderWeek();
      renderCalendar();
    </script>
  </body>
</html>
